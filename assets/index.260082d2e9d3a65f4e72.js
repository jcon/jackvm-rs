(()=>{"use strict";var e,t,n,r,i,a={497:(e,t,n)=>{n.a(e,(async e=>{var t=n(687),r=e([t]);t=(r.then?await r:r)[0];var i=document.getElementById("screen-container"),a=new t.i(i,{debugMemory:!1});document.onkeydown=a.handleKeyDown.bind(a),document.onkeyup=a.handleKeyUp.bind(a);var o=document.querySelector("#editor");function s(){var e=o.value.split("\n").map((function(e){return e.trim()})).join("\n");a.loadProgram(e)}o.addEventListener("change",(function(e){s()})),document.querySelector("#run").addEventListener("click",(function(e){(a.isPaused||a.isHalted())&&(s(),a.isPaused=!0,a.run())})),document.querySelector("#pause").addEventListener("click",(function(e){a.pause()})),fetch("vms/pong.vm").then((function(e){return e.text()})).then((function(e){o.value=e,s()})),s()}))},687:(e,t,n)=>{n.a(e,(async e=>{n.d(t,{i:()=>d});var r=n(588),i=e([r]);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}r=(i.then?await i:i)[0];var c=256,u=512;function l(e,t){var n=document.createElement("canvas");return n.className="screen",n.height=e,n.width=t,n}var h=function(){function e(t){a(this,e),this.vm=t;var n=[0,1,2,3,4],r=[256,257,258,259,260,261,262,24576];this.memoryCells={},this.initializedMemory=!1,this.allMemoryCellIds=[];var i=document.querySelector("#memory-body");if(void 0!==i){for(var o=0;o<r.length;o++){var s=document.createElement("tr"),c=document.createElement("th");c.innerHTML=r[o].toString(),s.appendChild(c);var u=document.createElement("td");u.innerHTML="0",s.appendChild(u),i.appendChild(s);var l=r[o];this.memoryCells[l]=u}var h=this;n.forEach((function(e){h.memoryCells[e]=document.querySelector("#mem-".concat(e))})),this.allMemoryCellIds=n.concat(r),this.initializedMemory=!0}}return s(e,[{key:"update",value:function(){if(this.initializedMemory){for(var e=this.vm.peek(0),t=0;t<this.allMemoryCellIds.length-1;t++){var n=this.allMemoryCellIds[t];this.memoryCells[n].innerHTML="".concat(this.vm.peek(n)).concat(e===n?" < SP":"")}this.memoryCells[24576].innerHTML="".concat(this.vm.peek(24575)," (key: ").concat(String.fromCharCode(this.vm.peek(24575)),")")}}}]),e}(),d=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{debugMemory:!0};a(this,e);var i=l(c,u);t.appendChild(i);var o=new ArrayBuffer(524288);this.screenBytes=new Uint8Array(o),this.vm=r.h4.new(o),this.imageData=new ImageData(u,c),this.imageData.data.set(this.screenBytes),this.isPaused=!0,this.isLoaded=!1,this.mainContext=i.getContext("2d"),n.debugMemory&&(this.memoryDebugger=new h(this.vm))}return s(e,[{key:"drawScreen",value:function(){this.isPaused||this.vm.isHalted()?console.log("VM is halted, no more screen refreshes."):requestAnimationFrame(this.drawScreen.bind(this)),this.vm.render_screen(),this.imageData.data.set(this.screenBytes),this.mainContext.putImageData(this.imageData,0,0)}},{key:"loadProgram",value:function(e){var t=this.vm.load(e);t.succeeded||console.log("errors ****",t.get_errors()),this.isLoaded=!0}},{key:"isHalted",value:function(){return this.vm.isHalted()}},{key:"restart",value:function(){this.isPaused=!0,this.vm.restart(),this.run()}},{key:"run",value:function(){this.isPaused&&(this.isPaused=!1,this.imageData.data.set(this.screenBytes),this.mainContext.putImageData(this.imageData,0,0),this.executeSteps(),this.drawScreen())}},{key:"pause",value:function(){this.isPaused=!0}},{key:"executeSteps",value:function(){this.isPaused||this.vm.isHalted()?console.log("VM is halted, no VM ticks."):requestAnimationFrame(this.executeSteps.bind(this)),this.vm.tick_times(3e4),this.memoryDebugger&&this.memoryDebugger.update()}},{key:"handleKeyDown",value:function(e){var t=(e=e||window.event).keyCode;37==t&&(t=130),39==t&&(t=132),this.vm.set_key(t)}},{key:"handleKeyUp",value:function(e){this.vm.set_key(0)}}]),e}()}))},588:(e,t,n)=>{n.a(e,(async e=>{n.d(t,{h4:()=>i.h4});var r=n(885),i=n(38),a=e([i,r]);[i,r]=a.then?await a:a}))},38:(e,t,n)=>{n.a(e,(async r=>{n.d(t,{h4:()=>k,ff:()=>x,ug:()=>S,F:()=>j,h9:()=>C,Dz:()=>E,kF:()=>D,Ht:()=>M,bi:()=>P,ID:()=>A,SW:()=>T,Or:()=>H});var i=n(885);e=n.hmd(e);var a=r([i]);i=(a.then?await a:a)[0];let o=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});o.decode();let s=null;function c(){return null!==s&&s.buffer===i.memory.buffer||(s=new Uint8Array(i.memory.buffer)),s}function u(e,t){return o.decode(c().subarray(e,e+t))}const l=new Array(32).fill(void 0);l.push(void 0,null,!0,!1);let h=l.length;function d(e){h===l.length&&l.push(l.length+1);const t=h;return h=l[t],l[t]=e,t}function m(e){return l[e]}function f(e){const t=m(e);return function(e){e<36||(l[e]=h,h=e)}(e),t}let _=0,p=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8");const y="function"==typeof p.encodeInto?function(e,t){return p.encodeInto(e,t)}:function(e,t){const n=p.encode(e);return t.set(n),{read:e.length,written:n.length}};function v(e,t,n){if(void 0===n){const n=p.encode(e),r=t(n.length);return c().subarray(r,r+n.length).set(n),_=n.length,r}let r=e.length,i=t(r);const a=c();let o=0;for(;o<r;o++){const t=e.charCodeAt(o);if(t>127)break;a[i+o]=t}if(o!==r){0!==o&&(e=e.slice(o)),i=n(i,r,r=o+3*e.length);const t=c().subarray(i+o,i+r);o+=y(e,t).written}return _=o,i}let g=null;function b(){return null!==g&&g.buffer===i.memory.buffer||(g=new Int32Array(i.memory.buffer)),g}class w{static __wrap(e){const t=Object.create(w.prototype);return t.ptr=e,t}free(){const e=this.ptr;this.ptr=0,i.__wbg_compilationresult_free(e)}get succeeded(){return 0!==i.__wbg_get_compilationresult_succeeded(this.ptr)}set succeeded(e){i.__wbg_set_compilationresult_succeeded(this.ptr,e)}get_errors(){return f(i.compilationresult_get_errors(this.ptr))}}class k{static __wrap(e){const t=Object.create(k.prototype);return t.ptr=e,t}free(){const e=this.ptr;this.ptr=0,i.__wbg_jackvirtualmachine_free(e)}static new(e){var t=i.jackvirtualmachine_new(d(e));return k.__wrap(t)}load(e){var t=v(e,i.__wbindgen_malloc,i.__wbindgen_realloc),n=_,r=i.jackvirtualmachine_load(this.ptr,t,n);return w.__wrap(r)}restart(){i.jackvirtualmachine_restart(this.ptr)}get_instruction(){try{const n=i.__wbindgen_export_2.value-16;i.__wbindgen_export_2.value=n,i.jackvirtualmachine_get_instruction(n,this.ptr);var e=b()[n/4+0],t=b()[n/4+1];return u(e,t)}finally{i.__wbindgen_export_2.value+=16,i.__wbindgen_free(e,t)}}render_screen(){i.jackvirtualmachine_render_screen(this.ptr)}tick(){i.jackvirtualmachine_tick(this.ptr)}isHalted(){return 0!==i.jackvirtualmachine_isHalted(this.ptr)}tick_times(e){i.jackvirtualmachine_tick_times(this.ptr,e)}set_key(e){i.jackvirtualmachine_set_key(this.ptr,e)}peek(e){return i.jackvirtualmachine_peek(this.ptr,e)}}const x=function(e,t){return d(u(e,t))},S=function(e){f(e)},j=function(e,t){alert(u(e,t))},C=function(){return d(new Error)},E=function(e,t){var n=v(m(t).stack,i.__wbindgen_malloc,i.__wbindgen_realloc),r=_;b()[e/4+1]=r,b()[e/4+0]=n},D=function(e,t){try{console.error(u(e,t))}finally{i.__wbindgen_free(e,t)}},M=function(e){return d(new Array(e>>>0))},P=function(e,t,n){m(e)[t>>>0]=f(n)},A=function(e,t,n){return d(new Uint32Array(m(e),t>>>0,n>>>0))},T=function(e,t,n){m(e)[t>>>0]=n>>>0},H=function(e,t){throw new Error(u(e,t))}}))},885:(e,t,n)=>{var r=([r])=>n.v(t,e.id,"a927ed7a73db4ce628f7",{"./web_bg.js":{__wbindgen_string_new:r.ff,__wbindgen_object_drop_ref:r.ug,__wbg_alert_bf0052a8f800ce7f:r.F,__wbg_new_59cb74e423758ede:r.h9,__wbg_stack_558ba5917b466edd:r.Dz,__wbg_error_4bb6c2a97407129a:r.kF,__wbg_newwithlength_76fae40da31b2e2c:r.Ht,__wbg_set_2485bb484a7ccb63:r.bi,__wbg_newwithbyteoffsetandlength_2016b902c412c87c:r.ID,__wbg_setindex_60fa756826393086:r.SW,__wbindgen_throw:r.Or}});n.a(e,(e=>{var t=e([n(38)]);return t.then?t.then(r):r(t)}),1)},85:()=>{}},o={};function s(e){if(o[e])return o[e].exports;var t=o[e]={id:e,loaded:!1,exports:{}};return a[e](t,t.exports,s),t.loaded=!0,t.exports}e="function"==typeof Symbol?Symbol("webpack then"):"__webpack_then__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n=e=>{e&&(e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},r=e=>!--e.r&&e(),i=(e,t)=>e?e.push(t):r(t),s.a=(a,o,s)=>{var c,u,l,h=s&&[],d=a.exports,m=!0,f=!1,_=(t,n,r)=>{f||(f=!0,n.r+=t.length,t.map(((t,i)=>{t[e](n,r)})),f=!1)},p=new Promise(((e,t)=>{l=t,u=()=>{e(d),n(h),h=0}}));p[t]=d,p[e]=(e,t)=>{if(m)return r(e);c&&_(c,e,t),i(h,e),p.catch(t)},a.exports=p,o((a=>{if(!a)return u();var o,s;c=(a=>a.map((a=>{if(null!==a&&"object"==typeof a){if(a[e])return a;if(a.then){var o=[];a.then((e=>{s[t]=e,n(o),o=0}));var s={[e]:(e,t)=>{i(o,e),a.catch(t)}};return s}}return{[e]:e=>{r(e)},[t]:a}})))(a);var l=new Promise(((e,n)=>{(o=()=>e(s=c.map((e=>e[t])))).r=0,_(c,o,n)}));return o.r?l:s})).then(u,l),m=!1},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),s.v=(e,t,n,r)=>{var i=fetch(s.p+""+n+".module.wasm");return"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,r).then((t=>Object.assign(e,t.instance.exports))):i.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,r))).then((t=>Object.assign(e,t.instance.exports)))},s(497),s(85)})();
//# sourceMappingURL=index.260082d2e9d3a65f4e72.js.map